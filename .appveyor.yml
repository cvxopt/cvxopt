version: 1.1.9.{build}-{branch}
configuration: Release
image: Visual Studio 2017
init:
- cmd: >-
    choco install wget
environment:
  CVXOPT_BLAS_LIB_DIR: c:\projects\cvxopt
  CVXOPT_SUITESPARSE_SRC_DIR: SuiteSparse
  matrix:
  - PYTHON: C:\Python27-x64
    PYTHON_VERSION: 27
    CVXOPT_BLAS_LIB: openblaspy
    CVXOPT_LAPACK_LIB: openblaspy
    CVXOPT_BLAS_EXTRA_LINK_ARGS: -lgfortran;-lquadmath
    COMPILER: mingwpy
  - PYTHON: C:\Python34-x64
    PYTHON_VERSION: 34
    CVXOPT_BLAS_LIB: openblaspy
    CVXOPT_LAPACK_LIB: openblaspy
    CVXOPT_BLAS_EXTRA_LINK_ARGS: -lgfortran;-lquadmath
    COMPILER: mingwpy
  - PYTHON: C:\Miniconda35-x64
    PYTHON_VERSION: 35
    CVXOPT_BLAS_LIB_DIR: C:\Miniconda35-x64\Library\lib
    CVXOPT_BLAS_LIB: openblas
    CVXOPT_LAPACK_LIB: openblas
    CVXOPT_MSVC: 1
  - PYTHON: C:\Miniconda36-x64
    PYTHON_VERSION: 36
    CVXOPT_BLAS_LIB_DIR: C:\Miniconda36-x64\Library\lib
    CVXOPT_BLAS_LIB: openblas
    CVXOPT_LAPACK_LIB: openblas
    CVXOPT_MSVC: 1

install:
- cmd: >-
    set PATH=%PYTHON%;%PYTHON%\Scripts;%PATH%

    python --version

    python -c "import struct; print(struct.calcsize('P') * 8)"

    wget http://faculty.cse.tamu.edu/davis/SuiteSparse/SuiteSparse-5.2.0.tar.gz && "C:\Program Files\7-Zip\7z" x SuiteSparse-5.2.0.tar.gz && "C:\Program Files\7-Zip\7z" x SuiteSparse-5.2.0.tar

    if [%COMPILER%]==[mingwpy] (
    wget https://bitbucket.org/carlkl/mingw-w64-for-python/downloads/OpenBLAS-0.2.17_amd64.7z &&
    mkdir openblas && "C:\Program Files\7-Zip\7z" x OpenBLAS-0.2.17_amd64.7z -aoa -oopenblas &&
    copy openblas\amd64\lib\libopenblaspy.a libopenblaspy.a &&
    pip install --disable-pip-version-check --user --upgrade pip &&
    pip install -i https://pypi.anaconda.org/carlkl/simple mingwpy )
    else (
    conda install -y -c conda-forge openblas )

    pip install wheel nose
build_script:
- cmd: >-
    if [%COMPILER%]==[mingwpy] (
    python setup.py build --compiler=mingw32 )
    else (
    python setup.py build --compiler=msvc )

    python setup.py install

    python setup.py bdist_wheel
test_script:
- cmd: >-
    python -c "from cvxopt import blas,lapack,cholmod,umfpack"

    nosetests
artifacts:
- path: dist/*.whl
